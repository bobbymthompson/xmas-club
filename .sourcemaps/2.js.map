{"version":3,"sources":["../../src/pages/weekly-leaderboard/weekly-leaderboard.module.ts","../../src/pages/weekly-leaderboard/weekly-leaderboard.ts"],"names":[],"mappings":"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","file":"2.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { WeeklyLeaderboardPage } from './weekly-leaderboard';\n\n@NgModule({\n  declarations: [\n    WeeklyLeaderboardPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(WeeklyLeaderboardPage),\n  ],\n  exports: [\n    WeeklyLeaderboardPage\n  ]\n})\nexport class WeeklyLeaderboardPageModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/weekly-leaderboard/weekly-leaderboard.module.ts","import { ScorecardsProvider } from '../../providers/scorecards-provider';\nimport { XmasClubDataProvider } from '../../providers/xmas-club.provider';\nimport { Component } from '@angular/core';\nimport { IonicPage, Loading, LoadingController, NavController, NavParams } from 'ionic-angular';\nimport { AuthProvider } from \"../../providers/auth.provider\";\nimport { Week } from \"../../models/week\";\nimport { Scorecard } from \"../../models/scorecard\";\nimport { GameResult } from \"../../models/game-result\";\nimport { Score } from \"../../models/score\";\nimport * as _ from \"underscore\";\n\n@IonicPage()\n@Component({\n  selector: 'page-weekly-leaderboard',\n  templateUrl: 'weekly-leaderboard.html',\n})\nexport class WeeklyLeaderboardPage {\n\n  week: Week;\n  loading: Loading;\n  scorecards: any;\n  games: GameResult[];\n\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    private authProvider: AuthProvider,\n    private scorecardsProvider: ScorecardsProvider,\n    private dataProvider: XmasClubDataProvider,\n    private loadingCtrl: LoadingController) {\n\n  }\n\n  async ionViewDidLoad() {\n\n    this.showLoading();\n\n    if (this.navParams.get('week')) {\n      this.week = await this.dataProvider.getWeek(parseInt(this.navParams.get('week')));\n    } else {\n      this.week = await this.dataProvider.currentWeek();\n    }\n\n    await this.loadWeeklyScorecards(this.navParams.get('favoritesOnly'));\n  }\n\n  private async loadWeeklyScorecards(favoritesOnly: boolean) {\n\n    this.games = await this.dataProvider.getGameResults(this.week.week);\n\n    let scorecards: Scorecard[] = await this.scorecardsProvider.getScorecards(this.week.week).first().toPromise();\n    console.log('Scorecards: ', scorecards);\n    let scorecardsWithPicks = [];\n\n    let scores = await this.dataProvider.scores.first().toPromise();\n    scores.forEach(async (score: Score) => {\n\n      let processScorecard = true;\n\n      if (favoritesOnly) {\n\n        if (this.authProvider.isAuthenticated && this.authProvider.user.favorites) {\n\n          if (this.authProvider.user.nickname === score.$key) {\n\n          }\n          else if (!_.some<string>(this.authProvider.user.favorites, nickname => nickname == score.$key)) {\n            processScorecard = false;\n          }\n        } else {\n          processScorecard = false;\n        }\n      }\n\n      if (processScorecard) {\n\n        let total = 0;\n        let submitted = false;\n        let weeklyScore = _.find(score.weeklyScores, (ws) => ws.week === this.week.week);\n        if (weeklyScore) {\n\n          total = weeklyScore.total ? weeklyScore.total : (weeklyScore.score ? weeklyScore.score : 0);\n        }\n\n        let scorecardWithPicks = {\n          nickname: score.$key,\n          score: total,\n          rank: 0,\n          tieBreakerScore: 0,\n          picks: []\n        };\n\n        let scorecard = _.find(scorecards, (sc) => sc.nickname === score.$key);\n        if (scorecard) {\n\n          scorecardWithPicks.tieBreakerScore = scorecard.tieBreakerScore;\n\n          scorecard.picks.forEach((pick) => {\n\n            let team;\n\n            if (pick.selectedPick) {\n              team = (pick.selectedPick === \"Team1\") ? pick.team1 : pick.team2;\n            }\n            \n            let result = this.dataProvider.calculatePickResult(this.week, pick, this.games);\n\n            scorecardWithPicks.picks.push({ team: team, complete: result.complete, correct: result.correct });\n\n          });\n        } else {\n          this.games.forEach((game) => {\n            scorecardWithPicks.picks.push({ team: '', complete: false, correct: false });\n          });\n        }\n\n        scorecardsWithPicks.push(scorecardWithPicks);\n      }\n    });\n\n    let orderedScorecardWithPicks = _.sortBy(scorecardsWithPicks, 'score').reverse();\n\n    let winnerIndex = _.findIndex(orderedScorecardWithPicks, { nickname: this.week.winner })\n    if (winnerIndex > 0) {\n      let winner = orderedScorecardWithPicks[winnerIndex];\n      orderedScorecardWithPicks.splice(winnerIndex, 1);\n      orderedScorecardWithPicks.splice(0, 0, winner);\n    }\n\n    let rank: number = 0;\n    let previousScore: number = 0;\n    for (let scorecard of orderedScorecardWithPicks) {\n\n      if (rank === 0 && winnerIndex > 0) {\n        /* The week is complete and we have a winner, set it so there is only one person who won */\n        /* I am ignoring ties at the moment */\n        rank = 1;\n      } else {\n\n        if (scorecard.score !== previousScore) {\n          rank++;\n        }\n\n        previousScore = scorecard.score;\n      }\n\n      scorecard.rank = rank;\n    }\n\n    this.scorecards = orderedScorecardWithPicks;\n  }\n\n  private showLoading() {\n    this.loading = this.loadingCtrl.create({\n      content: 'Please wait...',\n      dismissOnPageChange: true\n    });\n    this.loading.present();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/weekly-leaderboard/weekly-leaderboard.ts"],"sourceRoot":""}