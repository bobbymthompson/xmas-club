{"version":3,"sources":["../../src/pages/week/week.module.ts","../../src/pages/week/week.ts"],"names":[],"mappings":";;;;;;;;;;;;;;AAAA,sCAAyC;AACzC,gDAAgD;AAChD,wCAAkC;AAalC,IAAa,UAAU,GAAvB;CAA0B;AAAb,UAAU;IAXtB,eAAQ,CAAC;QACR,YAAY,EAAE;YACZ,eAAQ;SACT;QACD,OAAO,EAAE;YACP,+BAAe,CAAC,QAAQ,CAAC,eAAQ,CAAC;SACnC;QACD,OAAO,EAAE;YACP,eAAQ;SACT;KACF,CAAC;GACW,UAAU,CAAG;AAAb,gCAAU;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACdvB,sDAA0E;AAI1E,sCAA0C;AAC1C,gDAAgG;AAChG,uDAAyE;AAEzE,mCAAgC;AAEhC,yCAA2C;AAG3C,gDAA6D;AAU7D,IAAa,QAAQ,GAArB;IASE,YAAmB,OAAsB,EAChC,SAAoB,EACnB,YAA0B,EAC1B,kBAAsC,EACtC,YAAkC,EAClC,WAA8B;QALrB,YAAO,GAAP,OAAO,CAAe;QAChC,cAAS,GAAT,SAAS,CAAW;QACnB,iBAAY,GAAZ,YAAY,CAAc;QAC1B,uBAAkB,GAAlB,kBAAkB,CAAoB;QACtC,iBAAY,GAAZ,YAAY,CAAsB;QAClC,gBAAW,GAAX,WAAW,CAAmB;QAEtC,IAAI,CAAC,SAAS,GAAG,EAAE,CAAC;IACtB,CAAC;IAEK,eAAe;;YAEnB,IAAI,CAAC,WAAW,EAAE,CAAC;YAEnB,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;gBAC/B,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,QAAQ,CAAC,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC,CAAC,CAAC;YACpF,CAAC;YAAC,IAAI,CAAC,CAAC;gBACN,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,WAAW,EAAE,CAAC;YACpD,CAAC;YAED,IAAI,CAAC,gBAAgB,EAAE,CAAC;YAExB,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;QACzB,CAAC;KAAA;IAEM,KAAK;QACV,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,iBAAS,CAAC,CAAC;IAC/B,CAAC;IAEM,aAAa,CAAC,SAA0B;QAE7C,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,SAAS,CAAC,QAAQ,EAAE,CAAC,CAAC;IAC7F,CAAC;IAEM,kBAAkB;QAEvB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC;YAAC,MAAM,CAAC,KAAK,CAAC;QAE7B,+CAA+C;QAC/C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC;YAAC,MAAM,CAAC,KAAK,CAAC;QAErD,sFAAsF;QACtF,EAAE,CAAC,CAAC,IAAI,CAAC,mCAAmC,EAAE,CAAC;YAAC,MAAM,CAAC,KAAK,CAAC;QAE7D,wCAAwC;QACxC,EAAE,CAAC,CAAC,IAAI,IAAI,EAAE,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC;YAAC,MAAM,CAAC,KAAK,CAAC;QAE5D,MAAM,CAAC,IAAI,CAAC;IACd,CAAC;IAGO,mCAAmC;QAEzC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;YAE/B,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC;gBAEtC,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,mBAAmB,CAAC,CAAC,CAAC;oBAE9B,IAAI,CAAC,mBAAmB,GAAG,IAAI,CAAC;oBAEhC,IAAI,CAAC,kBAAkB,CAAC,YAAY,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,KAAK,EAAE,CAAC,SAAS,EAAE,CAAC,IAAI,CAAC,SAAS;wBACtH,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;4BACd,IAAI,CAAC,oBAAoB,GAAG,SAAS,CAAC;wBACxC,CAAC;wBAAC,IAAI,CAAC,CAAC;4BACN,OAAO,CAAC,GAAG,CAAC,8BAA8B,CAAC,CAAC;wBAC9C,CAAC;oBAEH,CAAC,CAAC,CAAC;gBACL,CAAC;YACH,CAAC;QACH,CAAC;QACD,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QAED,MAAM,CAAC,KAAK,CAAC;IACf,CAAC;IAEY,eAAe;;YAE1B,6BAA6B;YAC7B,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,IAAI,IAAI,CAAC,CAAC,CAAC;gBAExE,IAAI,CAAC,WAAW,EAAE,CAAC;gBAEnB,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC,CAAC;oBAE/B,IAAI,CAAC,oBAAoB,GAAG,MAAM,IAAI,CAAC,kBAAkB,CAAC,eAAe,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC;gBAC7H,CAAC;gBAED,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,eAAe,EAAE,EAAE,cAAc,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,EAAE,CAAC,CAAC;YAChI,CAAC;QACH,CAAC;KAAA;IAEM,sBAAsB;QAC3B,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,uBAAuB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,aAAa,EAAE,IAAI,EAAE,CAAC,CAAC;IAC5F,CAAC;IAEM,iBAAiB;QACtB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,uBAAuB,EAAE,EAAE,IAAI,EAAE,IAAI,CAAC,IAAI,CAAC,IAAI,EAAE,CAAC,CAAC;IACvE,CAAC;IAEa,gBAAgB;;YAE5B,IAAI,SAAS,GAA2B,IAAI,KAAK,EAAmB,CAAC;YACrE,IAAI,UAAU,GAA2B,IAAI,KAAK,EAAmB,CAAC;YAEtE,IAAI,MAAM,GAAG,MAAM,IAAI,CAAC,YAAY,CAAC,MAAM,CAAC,KAAK,EAAE,CAAC,SAAS,EAAE,CAAC;YAChE,MAAM,CAAC,OAAO,CAAC,CAAC,KAAY;gBAE1B,IAAI,KAAK,GAAG,CAAC,CAAC;gBACd,IAAI,SAAS,GAAG,KAAK,CAAC;gBACtB,IAAI,WAAW,GAAG,CAAC,CAAC,IAAI,CAAC,KAAK,CAAC,YAAY,EAAE,CAAC,EAAE,KAAK,EAAE,CAAC,IAAI,KAAK,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACjF,EAAE,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;oBAEhB,SAAS,GAAG,CAAC,WAAW,CAAC,KAAK,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,MAAM,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,CAAC,MAAM,GAAG,CAAC,CAAC,CAAC;oBAC7F,KAAK,GAAG,WAAW,CAAC,KAAK,GAAG,WAAW,CAAC,KAAK,GAAG,CAAC,WAAW,CAAC,KAAK,GAAG,WAAW,CAAC,KAAK,GAAG,CAAC,CAAC,CAAC;gBAC9F,CAAC;gBAED,IAAI,SAAS,GAAG;oBACd,QAAQ,EAAE,KAAK,CAAC,IAAI;oBACpB,KAAK,EAAE,KAAK;oBACZ,IAAI,EAAE,CAAC;iBACR,CAAC;gBAEF,EAAE,CAAC,CAAC,SAAS,CAAC,CAAC,CAAC;oBAEd,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC;wBAEtC,wDAAwD;wBACxD,EAAE,CAAC,CAAC,SAAS,CAAC,QAAQ,IAAI,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;4BAC1D,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;wBAC5B,CAAC;wBAED,2CAA2C;wBAC3C,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC;4BAErC,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAS,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,SAAS,EAAE,QAAQ,IAAI,QAAQ,IAAI,SAAS,CAAC,QAAQ,CAAC,CAAC,CAAC,CAAC;gCACjG,SAAS,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;4BAC5B,CAAC;wBACH,CAAC;oBACH,CAAC;oBAED,UAAU,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC;gBAC7B,CAAC;YACH,CAAC,CAAC,CAAC;YAEH,IAAI,iBAAiB,GAAG,CAAC,CAAC,MAAM,CAAC,UAAU,EAAE,OAAO,CAAC,CAAC,OAAO,EAAE,CAAC;YAEhE,IAAI,WAAW,GAAG,CAAC,CAAC,SAAS,CAAC,iBAAiB,EAAE,EAAE,QAAQ,EAAE,IAAI,CAAC,IAAI,CAAC,MAAM,EAAE,CAAC;YAChF,EAAE,CAAC,CAAC,WAAW,GAAG,CAAC,CAAC,CAAC,CAAC;gBACpB,IAAI,MAAM,GAAG,iBAAiB,CAAC,WAAW,CAAC,CAAC;gBAC5C,iBAAiB,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,CAAC,CAAC;gBACzC,iBAAiB,CAAC,MAAM,CAAC,CAAC,EAAE,CAAC,EAAE,MAAM,CAAC,CAAC;YACzC,CAAC;YAED,IAAI,IAAI,GAAW,CAAC,CAAC;YACrB,IAAI,aAAa,GAAW,CAAC,CAAC;YAC9B,GAAG,CAAC,CAAC,IAAI,SAAS,IAAI,iBAAiB,CAAC,CAAC,CAAC;gBAExC,EAAE,CAAC,CAAC,IAAI,KAAK,CAAC,IAAI,WAAW,GAAG,CAAC,CAAC,CAAC,CAAC;oBAClC,2FAA2F;oBAC3F,sCAAsC;oBACtC,IAAI,GAAG,CAAC,CAAC;gBACX,CAAC;gBAAC,IAAI,CAAC,CAAC;oBAEN,EAAE,CAAC,CAAC,SAAS,CAAC,KAAK,KAAK,aAAa,CAAC,CAAC,CAAC;wBACtC,IAAI,EAAE,CAAC;oBACT,CAAC;oBAED,aAAa,GAAG,SAAS,CAAC,KAAK,CAAC;gBAClC,CAAC;gBAED,SAAS,CAAC,IAAI,GAAG,IAAI,CAAC;YACxB,CAAC;YAED,IAAI,CAAC,SAAS,GAAG,CAAC,CAAC,MAAM,CAAC,SAAS,EAAE,MAAM,CAAC,CAAC;YAE7C,IAAI,CAAC,UAAU,GAAG,iBAAiB,CAAC;QACtC,CAAC;KAAA;IAEO,4BAA4B;QAElC,EAAE,CAAC,CAAC,IAAI,CAAC,YAAY,CAAC,eAAe,CAAC,CAAC,CAAC;YACtC,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QAED,EAAE,CAAC,CAAC,IAAI,CAAC,IAAI,IAAI,IAAI,IAAI,EAAE,IAAI,IAAI,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YAC3D,MAAM,CAAC,IAAI,CAAC;QACd,CAAC;QAED,MAAM,CAAC,KAAK,CAAC;IACf,CAAC;IAEO,WAAW;QACjB,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC,WAAW,CAAC,MAAM,CAAC;YACrC,OAAO,EAAE,gBAAgB;YACzB,mBAAmB,EAAE,IAAI;SAC1B,CAAC,CAAC;QACH,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC;IACzB,CAAC;CACF;AAnNY,QAAQ;IAPpB,yBAAS,CAAC;QACT,OAAO,EAAE,YAAY;KACtB,CAAC;IACD,gBAAS,CAAC;QACT,QAAQ,EAAE,WAAW;OACG;KACzB,CAAC;kCAUyC;QACrB,yBAAS;QACL,4BAAY;QACN,wCAAkB;QACxB,mCAAoB;QACrB,KAAiB;GAd7B,QAAQ,CAmNpB;AAnNY,4BAAQ,I","file":"3.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { IonicPageModule } from 'ionic-angular';\nimport { WeekPage } from './week';\n\n@NgModule({\n  declarations: [\n    WeekPage,\n  ],\n  imports: [\n    IonicPageModule.forChild(WeekPage),\n  ],\n  exports: [\n    WeekPage\n  ]\n})\nexport class WeekModule {}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/week/week.module.ts","import { WeeksProvider } from '../../providers/weeks-provider';\nimport { XmasClubDataProvider } from '../../providers/xmas-club.provider';\nimport { cordovaWarn } from 'ionic-native/dist/esm';\nimport { GameResult } from '../../models/game-result';\nimport { Scorecard, Pick, WeeklyScorecard } from '../../models/scorecard';\nimport { Component } from '@angular/core';\nimport { IonicPage, Loading, LoadingController, NavController, NavParams } from 'ionic-angular';\nimport { ScorecardsProvider } from '../../providers/scorecards-provider';\nimport { User } from '../../models/user';\nimport * as _ from 'underscore';\nimport { Week } from \"../../models/week\";\nimport { LoginPage } from \"../login/login\";\nimport { Observable } from 'rxjs/Observable';\nimport { FirebaseObjectObservable, FirebaseListObservable } from 'angularfire2/database';\nimport { AuthProvider } from \"../../providers/auth.provider\";\nimport { Score } from \"../../models/score\";\n\n@IonicPage({\n  segment: 'week/:week'\n})\n@Component({\n  selector: 'page-week',\n  templateUrl: 'week.html',\n})\nexport class WeekPage {\n\n  week: Week;\n  scorecards: WeeklyScorecard[];\n  favorites: WeeklyScorecard[];\n  currentUserScorecard: Scorecard;\n  loading: Loading;\n\n\n  constructor(public navCtrl: NavController,\n    public navParams: NavParams,\n    private authProvider: AuthProvider,\n    private scorecardsProvider: ScorecardsProvider,\n    private dataProvider: XmasClubDataProvider,\n    private loadingCtrl: LoadingController) {\n\n    this.favorites = [];\n  }\n\n  async ionViewDidEnter() {\n\n    this.showLoading();\n\n    if (this.navParams.get('week')) {\n      this.week = await this.dataProvider.getWeek(parseInt(this.navParams.get('week')));\n    } else {\n      this.week = await this.dataProvider.currentWeek();\n    }\n\n    this.loadWeeklyScores();\n\n    this.loading.dismiss();\n  }\n\n  public login() {\n    this.navCtrl.push(LoginPage);\n  }\n\n  public viewScorecard(scorecard: WeeklyScorecard) {\n\n    this.navCtrl.push('ScorecardPage', { week: this.week.week, nickname: scorecard.nickname });\n  }\n\n  public canCreateScorecard(): boolean {\n\n    if (!this.week) return false;\n\n    /* Only if the current user is authenticated */\n    if (!this.authProvider.isAuthenticated) return false;\n\n    /* Only if this is the current users doesn't already have a scorecard for this week */\n    if (this.doesCurrentUserHaveScorecardAlready()) return false;\n\n    /* Only if it is before the due date. */\n    if (new Date() >= new Date(this.week.dueDate)) return false;\n\n    return true;\n  }\n\n  private queriedForScorecard: boolean;\n  private doesCurrentUserHaveScorecardAlready(): boolean {\n\n    if (!this.currentUserScorecard) {\n\n      if (this.authProvider.isAuthenticated) {\n\n        if (!this.queriedForScorecard) {\n\n          this.queriedForScorecard = true;\n\n          this.scorecardsProvider.getScorecard(this.week.week, this.authProvider.user.nickname).first().toPromise().then(scorecard => {\n            if (scorecard) {\n              this.currentUserScorecard = scorecard;\n            } else {\n              console.log('No scorecard exists for user');\n            }\n\n          });\n        }\n      }\n    }\n    else {\n      return true;\n    }\n\n    return false;\n  }\n\n  public async createScorecard() {\n\n    /* Create a new scorecard. */\n    if (this.authProvider.isAuthenticated && this.authProvider.user != null) {\n\n      this.showLoading();\n\n      if (!this.currentUserScorecard) {\n\n        this.currentUserScorecard = await this.scorecardsProvider.createScorecard(this.week.week, this.authProvider.user.nickname);\n      }\n\n      this.navCtrl.push('ScorecardPage', { enableEditMode: true, week: this.week.week, nickname: this.authProvider.user.nickname });\n    }\n  }\n\n  public viewFavoriteScorecards() {\n    this.navCtrl.push('WeeklyLeaderboardPage', { week: this.week.week, favoritesOnly: true });\n  }\n\n  public viewAllScorecards() {\n    this.navCtrl.push('WeeklyLeaderboardPage', { week: this.week.week });\n  }\n\n  private async loadWeeklyScores() {\n\n    let favorites: Array<WeeklyScorecard> = new Array<WeeklyScorecard>();\n    let scorecards: Array<WeeklyScorecard> = new Array<WeeklyScorecard>();\n\n    let scores = await this.dataProvider.scores.first().toPromise();\n    scores.forEach((score: Score) => {\n\n      let total = 0;\n      let submitted = false;\n      let weeklyScore = _.find(score.weeklyScores, (ws) => ws.week === this.week.week);\n      if (weeklyScore) {\n\n        submitted = (weeklyScore.total != null) || (this.week.winner && this.week.winner.length > 0);\n        total = weeklyScore.total ? weeklyScore.total : (weeklyScore.score ? weeklyScore.score : 0);\n      }\n\n      let scorecard = {\n        nickname: score.$key,\n        score: total,\n        rank: 0\n      };\n\n      if (submitted) {\n\n        if (this.authProvider.isAuthenticated) {\n\n          /* Populate the current user into the favorites list. */\n          if (scorecard.nickname == this.authProvider.user.nickname) {\n            favorites.push(scorecard);\n          }\n\n          /* Populate any favorites for this user. */\n          if (this.authProvider.user.favorites) {\n\n            if (_.some<string>(this.authProvider.user.favorites, nickname => nickname == scorecard.nickname)) {\n              favorites.push(scorecard);\n            }\n          }\n        }\n\n        scorecards.push(scorecard);\n      }\n    });\n\n    let orderedScorecards = _.sortBy(scorecards, 'score').reverse();\n\n    let winnerIndex = _.findIndex(orderedScorecards, { nickname: this.week.winner })\n    if (winnerIndex > 0) {\n      let winner = orderedScorecards[winnerIndex];\n      orderedScorecards.splice(winnerIndex, 1);\n      orderedScorecards.splice(0, 0, winner);\n    }\n\n    let rank: number = 0;\n    let previousScore: number = 0;\n    for (let scorecard of orderedScorecards) {\n\n      if (rank === 0 && winnerIndex > 0) {\n        /* The week is complete and we have a winner, set it so there is only one person who won */\n        /* I am ignoring ties at the moment */\n        rank = 1;\n      } else {\n\n        if (scorecard.score !== previousScore) {\n          rank++;\n        }\n\n        previousScore = scorecard.score;\n      }\n\n      scorecard.rank = rank;\n    }\n\n    this.favorites = _.sortBy(favorites, 'rank');\n\n    this.scorecards = orderedScorecards;\n  }\n\n  private canViewDetailedScorecardView() {\n\n    if (this.authProvider.isAdministrator) {\n      return true;\n    }\n\n    if (this.week && new Date() >= new Date(this.week.dueDate)) {\n      return true;\n    }\n\n    return false;\n  }\n\n  private showLoading() {\n    this.loading = this.loadingCtrl.create({\n      content: 'Please wait...',\n      dismissOnPageChange: true\n    });\n    this.loading.present();\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/week/week.ts"],"sourceRoot":""}